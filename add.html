<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Timeline</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/general.css">
    <link rel="stylesheet" href="assets/css/add.css">
    
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar" style="background-color: #554f4a;">
        <div class="logo" style="padding-top: 45px;">
            <div class="profile-header" id="profile-header">
                <img src="assets/img/profile.png" alt="Profile" id="profile-img">
                <h2 id="user-name">Loading...</h2>
            </div>
        </div>
        <ul>
            <a href="index.html">
                <li>Dashboard</li>
            </a>
            <a href="add.html">
                <li class="active">Add New Timeline</li>
            </a>
            <a href="reports.html">
                <li>Timeline Reports</li>
            </a>
            <!--
            <a href="#" id="logout-link">
                <li>Logout</li>
            </a>
            -->
        </ul>
    </div>

    <!-- Header -->
    <div class="header" style="background-color: #5b4a3f;">
        <span class="hamburger" id="hamburger"><i class="fas fa-bars"></i></span>
        <div class="logo">
            <h3>THT of Bukidnon</h3>
            <p>*Preserving Culture and Tradition*</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content" id="content">
        <div class="container">
            <h2 class="text-center">Add New Timeline</h2>
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="btn btn-sm btn-primary" id="prev-month">&laquo; Previous</button>
                    <h4 id="current-month-year"></h4>
                    <button class="btn btn-sm btn-primary" id="next-month">Next &raquo;</button>
                </div>
                <div class="calendar" id="calendar"></div>
            </div>
        </div>
    </div>

    <!-- Modal for data input -->
    <div class="modal fade" id="dataModal" tabindex="-1" aria-labelledby="dataModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dataModalLabel">Add Data for <span id="selectedDate"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-form">
                        <div class="form-group mb-3">
                            <label for="title">Title</label>
                            <input type="text" id="title" name="title" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="festival">Festival</label>
                            <input type="text" id="festival" name="festival" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group mb-3">
                            <label for="image">Choose Image</label>
                            <input type="file" id="image" name="image" class="form-control" accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-success">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const calendar = document.getElementById("calendar");
        const dataModal = new bootstrap.Modal(document.getElementById("dataModal"));
        const selectedDateElement = document.getElementById("selectedDate");
        const currentMonthYear = document.getElementById("current-month-year");
        const prevMonthBtn = document.getElementById("prev-month");
        const nextMonthBtn = document.getElementById("next-month");

        let currentDate = new Date();

        function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // Add weekday headers
    calendar.innerHTML = `
        <div class="header" style="background-color:red;">Sun</div>
        <div class="header">Mon</div>
        <div class="header">Tue</div>
        <div class="header">Wed</div>
        <div class="header">Thu</div>
        <div class="header">Fri</div>
        <div class="header" style="background-color:yellow; color:black;">Sat</div>
    `;

    // Add blank days for previous month's overflow
    for (let i = 0; i < firstDay; i++) {
        calendar.innerHTML += `<div class="calendar-day empty-day"></div>`;
    }

    // Add the days of the current month
    for (let day = 1; day <= daysInMonth; day++) {
        const dateObj = new Date(year, month, day);
        const dateStr = dateObj.toLocaleDateString("en-CA"); // Format as YYYY-MM-DD
        const isToday = dateStr === new Date().toLocaleDateString("en-CA");

        calendar.innerHTML += `
            <div class="calendar-day${isToday ? ' current-day' : ''}" data-date="${dateStr}">
                ${day}
            </div>
        `;
    }

    // Update the current month and year in the header
    currentMonthYear.textContent = date.toLocaleString("default", { month: "long", year: "numeric" });

    // Add click events to the calendar days
    document.querySelectorAll(".calendar-day").forEach(dayElement => {
        dayElement.addEventListener("click", () => {
            const selectedDate = dayElement.dataset.date;
            selectedDateElement.textContent = selectedDate;
            document.getElementById("modal-form").reset();
            dataModal.show();
        });
    });
}



        prevMonthBtn.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        });

        nextMonthBtn.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        });

        document.getElementById("modal-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const date = selectedDateElement.textContent;
    const title = document.getElementById("title").value;
    const festival = document.getElementById("festival").value;
    const description = document.getElementById("description").value;
    const imageInput = document.getElementById("image").files[0];

    const reader = new FileReader();
    reader.onload = function (event) {
        const imageBase64 = event.target.result;

        const newEntry = { title, festival, description, image: imageBase64, date };

        const existingData = JSON.parse(localStorage.getItem("timelineData")) || [];
        existingData.push(newEntry);
        localStorage.setItem("timelineData", JSON.stringify(existingData));

        dataModal.hide();
        alert(`Data saved successfully for the date: ${date}`);
    };

    reader.readAsDataURL(imageInput);
});


        // Render the calendar for the current month initially
        renderCalendar(currentDate);
    </script>
<script src="assets/js/dashboard.js"></script>
</body>

</html>
